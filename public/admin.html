<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin - ChupChup Cremosão da Barra</title>
<style>
:root {
  --yellow: #f5c144;
  --accent: #651616;
  --card-bg: #ffffff;
  --muted: #666;
}
* { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
body { background-color:#f8f8f8; min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:2rem; }
header { background-color:var(--accent); color:#fff; padding:1rem 2rem; width:100%; text-align:center; border-radius:12px; margin-bottom:2rem; font-size:1.4rem; font-weight:bold; }

.form-card { background:var(--card-bg); padding:1.5rem; border-radius:12px; width:100%; max-width:480px; box-shadow:0 4px 20px rgba(0,0,0,0.1); margin-bottom:2rem; }
.form-card h2 { color:var(--accent); margin-bottom:1rem; text-align:center; }
.input-group { margin-bottom:1rem; }
.input-group label { display:block; color:var(--muted); font-size:0.9rem; margin-bottom:0.4rem; }
.input-group input, .input-group textarea { width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:1rem; outline:none; transition:border-color 0.3s; }
.input-group input:focus, .input-group textarea:focus { border-color:var(--yellow); }
.preview { margin-top:0.5rem; text-align:center; }
.preview img { width:100px; height:100px; object-fit:cover; border-radius:10px; border:2px solid var(--accent); }

button { background-color:var(--accent); color:#fff; width:100%; padding:12px; border:none; border-radius:8px; font-size:1rem; cursor:pointer; transition:background 0.3s; }
button:hover { background-color:var(--yellow); color:var(--accent); font-weight:600; }

.produtos-lista { width:100%; max-width:600px; }
.produto { background:var(--card-bg); border-radius:10px; padding:1rem; margin-bottom:1rem; display:flex; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
.produto img { width:80px; height:80px; border-radius:8px; object-fit:cover; margin-right:1rem; border:2px solid var(--accent); }
.produto-info { flex:1; }
.produto-info h3 { color:var(--accent); font-size:1.1rem; }
.produto-info p { color:var(--muted); font-size:0.9rem; }
.produto-info span { color:var(--yellow); font-weight:bold; font-size:1rem; }
.produto-info button { margin-top:6px; background:#f44336; width:auto; padding:6px 12px; font-size:0.9rem; border-radius:6px; border:none; cursor:pointer; }
.produto-info button:hover { background:#ff7961; }
</style>
</head>
<body>
<header>Painel do Admin - ChupChup Cremosão da Barra</header>

<div class="form-card">
<h2>Cadastrar novo produto</h2>
<form id="produtoForm">
  <div class="input-group">
    <label for="nome">Nome do produto</label>
    <input type="text" id="nome" required placeholder="Ex: ChupChup de Morango" />
  </div>
  <div class="input-group">
    <label for="descricao">Descrição</label>
    <textarea id="descricao" rows="3" placeholder="Ex: Cremoso e refrescante sabor de morango" required></textarea>
  </div>
  <div class="input-group">
    <label for="preco">Preço (R$)</label>
    <input type="number" id="preco" required step="0.01" placeholder="Ex: 4.50" />
  </div>
  <div class="input-group">
    <label for="imagem">Foto do produto</label>
    <input type="file" id="imagem" accept="image/*" required />
    <div class="preview" id="preview"></div>
  </div>
  <button type="submit">Cadastrar produto</button>
</form>
</div>

<div class="produtos-lista" id="produtosLista"></div>

<script>
const form = document.getElementById("produtoForm");
const preview = document.getElementById("preview");
const lista = document.getElementById("produtosLista");

// Preview da imagem
document.getElementById("imagem").addEventListener("change", function(){
  const file = this.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => preview.innerHTML = `<img src="${e.target.result}" alt="Prévia do produto">`;
    reader.readAsDataURL(file);
  }
});

// Cadastrar produto
form.addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData();
  formData.append("nome", document.getElementById("nome").value);
  formData.append("descricao", document.getElementById("descricao").value);
  formData.append("preco", document.getElementById("preco").value);
  formData.append("imagem", document.getElementById("imagem").files[0]);

  const res = await fetch("/api/produtos", { method:"POST", body: formData });
  const data = await res.json();
  if(res.ok){ alert(data.mensagem); form.reset(); preview.innerHTML=""; carregarProdutos(); }
  else alert(data.erro);
});

// Carregar produtos
async function carregarProdutos(){
  const res = await fetch("/api/produtos");
  const produtos = await res.json();

  lista.innerHTML = produtos.map(p => `
    <div class="produto">
      <img src="${p.imagem}" alt="${p.nome}">
      <div class="produto-info">
        <h3>${p.nome}</h3>
        <p>${p.descricao}</p>
        <span>R$ ${parseFloat(p.preco).toFixed(2)}</span>
        <button onclick="removerProduto(${p.id})">Remover</button>
      </div>
    </div>
  `).join("");
}

// Remover produto
async function removerProduto(id){
  if(!confirm("Deseja realmente remover este produto?")) return;
  const res = await fetch(`/api/produtos/${id}`, { method:"DELETE" });
  const data = await res.json();
  if(res.ok) carregarProdutos();
  else alert(data.erro);
}

// Inicializar
carregarProdutos();
</script>
</body>
</html>
